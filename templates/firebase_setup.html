<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://*.firebaseio.com https://*.googleapis.com; style-src 'self' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://www.gstatic.com 'unsafe-inline'; font-src 'self' https://fonts.gstatic.com; script-src 'self' https://*.firebaseio.com https://*.googleapis.com https://www.gstatic.com 'unsafe-inline'; connect-src 'self' https://*.firebaseio.com https://*.googleapis.com wss://*.firebaseio.com img-src 'self' https://console.firebase.google.com;">
    <title>ELI5 Buddy - Firebase Setup Guide</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4285f4;
            --secondary-color: #ea4335;
            --background-color: #f8f9fa;
            --text-color: #333;
            --success-color: #34a853;
            --warning-color: #fbbc05;
            --error-color: #ea4335;
        }
        
        body {
            font-family: 'Nunito', sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 15px 0;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        nav a {
            color: var(--text-color);
            text-decoration: none;
            margin-left: 20px;
            font-weight: 600;
        }
        
        nav a:hover {
            color: var(--primary-color);
        }
        
        .status-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 30px;
        }
        
        .status-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .status-icon {
            font-size: 2rem;
        }
        
        .status-title {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .status-label {
            flex: 1;
            font-weight: 600;
        }
        
        .status-value {
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .success {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--success-color);
        }
        
        .error {
            background-color: rgba(234, 67, 53, 0.1);
            color: var(--error-color);
        }
        
        .warning {
            background-color: rgba(251, 188, 5, 0.1);
            color: var(--warning-color);
        }
        
        .step-card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .step-number {
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .step-title {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .step-content {
            margin-left: 40px;
        }
        
        .code-block {
            background-color: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            margin: 15px 0;
        }
        
        .btn {
            display: inline-block;
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        
        .btn:hover {
            background-color: #3367d6;
        }
        
        .error-details {
            background-color: rgba(234, 67, 53, 0.1);
            border-left: 4px solid var(--error-color);
            padding: 15px;
            margin: 15px 0;
        }
        
        img {
            max-width: 100%;
            border-radius: 4px;
            border: 1px solid #ddd;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-lightbulb"></i>
                <span>ELI5 Buddy</span>
            </div>
            <nav>
                <a href="/">Home</a>
                <a href="/dashboard">Dashboard</a>
                <a href="/diagnostic">Diagnostic</a>
            </nav>
        </div>
    </header>
    
    <div class="container">
        <h1>Firebase Setup Guide</h1>
        
        <div class="status-card">
            <div class="status-header">
                <i class="fas fa-server status-icon" style="color: var(--primary-color);"></i>
                <h2 class="status-title">Firebase Status</h2>
            </div>
            
            <div class="status-item">
                <div class="status-label">Firebase Admin SDK:</div>
                <div class="status-value {% if firebase_status.initialized %}success{% else %}error{% endif %}">
                    {% if firebase_status.initialized %}Initialized{% else %}Failed{% endif %}
                </div>
            </div>
            
            <div class="status-item">
                <div class="status-label">Firestore Database:</div>
                <div class="status-value {% if firebase_status.firestore_available %}success{% else %}error{% endif %}">
                    {% if firebase_status.firestore_available %}Available{% else %}Unavailable{% endif %}
                </div>
            </div>
            
            {% if firestore_error %}
            <div class="error-details">
                <strong>Error Details:</strong>
                <p>{{ firestore_error }}</p>
            </div>
            {% endif %}
            
            <div class="status-item">
                <div class="status-label">Project ID:</div>
                <div class="status-value">{{ project_id or 'Unknown' }}</div>
            </div>
        </div>
        
        <h2>How to Fix Firebase Setup</h2>
        
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">1</div>
                <h3 class="step-title">Access Firebase Console</h3>
            </div>
            <div class="step-content">
                <p>Visit the Firebase Console and sign in with your Google account.</p>
                <a href="https://console.firebase.google.com/" target="_blank" class="btn">Open Firebase Console</a>
                
                <p>Make sure you have access to the project with ID: <strong>{{ project_id or 'Check your service_acc.json file' }}</strong></p>
                
                {% if project_id %}
                <a href="https://console.firebase.google.com/project/{{ project_id }}/overview" target="_blank" class="btn">Go to Project</a>
                {% endif %}
            </div>
        </div>
        
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">2</div>
                <h3 class="step-title">Enable Firestore Database</h3>
            </div>
            <div class="step-content">
                <p>The error indicates that Firestore is not enabled for your project. Follow these steps to enable it:</p>
                
                <ol>
                    <li>In the Firebase Console, go to your project</li>
                    <li>Click on "Firestore Database" in the left navigation menu</li>
                    <li>Click the "Create database" button</li>
                    <li>Choose "Start in test mode" for development (you can change this later)</li>
                    <li>Select a database location closest to your users</li>
                    <li>Click "Enable"</li>
                </ol>
                
                {% if project_id %}
                <a href="https://console.firebase.google.com/project/{{ project_id }}/firestore" target="_blank" class="btn">Go to Firestore</a>
                {% endif %}
            </div>
        </div>
        
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">3</div>
                <h3 class="step-title">Verify IAM Permissions</h3>
            </div>
            <div class="step-content">
                <p>Make sure your service account has the necessary permissions:</p>
                
                <ol>
                    <li>In the Firebase Console, go to Project Settings</li>
                    <li>Click on the "Service accounts" tab</li>
                    <li>Check if your service account (used in service_acc.json) has the "Firebase Admin SDK Administrator Service Agent" role</li>
                    <li>If not, you may need to regenerate your service account key</li>
                </ol>
                
                {% if project_id %}
                <a href="https://console.firebase.google.com/project/{{ project_id }}/settings/serviceaccounts/adminsdk" target="_blank" class="btn">Go to Service Accounts</a>
                {% endif %}
            </div>
        </div>
        
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">4</div>
                <h3 class="step-title">Restart Your Application</h3>
            </div>
            <div class="step-content">
                <p>After enabling Firestore in the Firebase Console, restart your application to initialize Firestore properly.</p>
                
                <div class="code-block">
                    <pre>python app.py</pre>
                </div>
                
                <p>After restarting, verify the Firestore connection by visiting the diagnostic page:</p>
                
                <a href="/diagnostic" class="btn">Go to Diagnostic Page</a>
            </div>
        </div>
        
        <div class="step-card">
            <div class="step-header">
                <div class="step-number">5</div>
                <h3 class="step-title">Test Premium Features</h3>
            </div>
            <div class="step-content">
                <p>Once Firestore is properly enabled and connected, you can test premium features using test mode:</p>
                
                <ol>
                    <li>Log in to your application</li>
                    <li>Navigate to the dashboard</li>
                    <li>Use the premium features, which should now work properly</li>
                </ol>
                
                <a href="/dashboard" class="btn">Go to Dashboard</a>
            </div>
        </div>
    </div>
</body>
</html> 